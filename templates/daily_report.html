<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>{{ year }}年{{ month }}月{{ day }}日の日報</title>
</head>
<body>
    <h1>{{ year }}年{{ month }}月{{ day }}日の日報ページ</h1>
    {% if message %}
        <p style="color:green">{{ message }}</p>
    {% endif %}
<form method="post">
 <h3>出勤ドクター</h3>
<table border="1">
    <tr>
        <th>時間帯</th>
        <th>担当ドクター（複数選択OK）</th>
    </tr>
    {% for period in ['AM', 'PM',] %}
    <tr>
        <td>{{ period }}</td>
        <td>
            {# TODO: ドクターの選択状態をデータベースから読み込む処理を追加 #}
            {% for doctor in doctors %}
                <label>
                    <input type="checkbox" name="doctors_{{ period }}" value="{{ doctor[0] }}">
                    {{ doctor[1] }}
                </label>
            {% endfor %}
        </td>
    </tr>
    {% endfor %}
</table>
<h3>患者数</h3>
<table border="1">
    <tr>
        <th>時間帯</th>
        <th>新患</th>
        <th>再診</th>
        <th>合計</th>
    </tr>
    {% for period in ['AM', 'PM'] %}
    <tr>
        <td>{{ period }}</td>
        <td><input type="number" name="new_{{ period }}" min="0" value="{{ shifts[period].new_patients if shifts[period] else 0 }}"></td>
        <td><input type="number" name="return_{{ period }}" min="0" value="{{ shifts[period].returning_patients if shifts[period] else 0 }}"></td>
        <td><input type="number" name="total_{{ period }}" min="0" value="{{ shifts[period].total_patients if shifts[period] else 0 }}"></td>
    </tr>
    {% endfor %}
</table>

<h3>処置・検査記録</h3>
<table border="1">
    <tr>
        <th>処置名</th>
        <th>AM</th>
        <th>PM</th>
        <th>夜間</th>
    </tr>
    {% for procedure in procedures %}
    <tr>
        <td>{{ procedure[1] }}</td>
        {% for period in ['AM', 'PM'] %}
        <td>
            <input type="number"
                   name="procedure_{{ procedure[0] }}_{{ period }}"
                   min="0"
                   value="{{ procedures_records[procedure[0]][period] if procedures_records[procedure[0]] and procedures_records[procedure[0]][period] is defined else 0 }}">
        </td>
        {% endfor %}
        <td>
            {# TODO: 夜間の入力フィールドを追加する場合、app.pyと合わせて実装 #}
        </td>
    </tr>
    {% endfor %}
</table>


　　　<br><br>
  <label>保険点数: <input type="number" name="total_points" min="0" value="{{ total_points }}"></label><br><br>
    <label>売上金額: <input type="number" name="total_sales" min="0" value="{{ total_sales }}"></label><br><br>
  <button type="submit">保存</button>
</form>

<form method="post" action="{{ url_for('delete_report', year=year, month=month, day=day) }}" onsubmit="return confirm('この日の日報を本当に削除しますか？');">
    <button type="submit" style="background-color: red; color: white;">この日の日報を削除</button>
</form>


    <p><a href="{{ url_for('index') }}">カレンダーに戻る</a></p>
</body>
</html>